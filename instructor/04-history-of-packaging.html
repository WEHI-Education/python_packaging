<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Python Packaging: Extra: A History of Python Build Tools</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../04-history-of-packaging.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Python Packaging
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Python Packaging
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Python Packaging
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 51%" class="percentage">
    51%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 51%" aria-valuenow="51" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../04-history-of-packaging.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-scripts-and-modules.html">1. Python Scripts and Modules</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-packages.html">2. From Modules to Packages</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-building-and-installing.html">3. Building and Installing Packages using setuptools</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        4. Extra: A History of Python Build Tools
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#in-the-beginning-there-was-distutils">In the beginning, there was <code>distutils</code></a></li>
<li><a href="#setuptools-and-egg-files"><code>setuptools</code> and <code>egg</code> files</a></li>
<li><a href="#using-pip-instead-of-running-setup.py">Using <code>pip</code> instead of running <code>setup.py</code></a></li>
<li><a href="#setup.cfg-as-a-declarative-config"><code>setup.cfg</code> as a ‘Declarative Config’</a></li>
<li><a href="#pyproject.toml-and-circular-build-requirements"><code>pyproject.toml</code> and Circular Build Requirements</a></li>
<li><a href="#moving-to-pyproject.toml-only-builds">Moving to <code>pyproject.toml</code>-only builds</a></li>
<li><a href="#the-end-of-setup.py">The end of <code>setup.py</code></a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-publishing.html">5. Publishing our Python Packages</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr></ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-building-and-installing.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/05-publishing.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-building-and-installing.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Building and
        </a>
        <a class="chapter-link float-end" href="../instructor/05-publishing.html" rel="next">
          Next: Publishing our... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Extra: A History of Python Build Tools</h1>
        <p> Last updated on 2023-11-21 | 
        
        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/episodes/04-history-of-packaging.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 30 minutes </p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>Why have the ‘best practices’ for building and installing Python
packages changed so much of the years?</li>
<li>What problems has each new iteration solved?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the history of Python packaging</li>
<li>Understand what each method does when we install a package</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>This lesson can be skipped entirely if you’re aiming for a purely
practical lesson.</p>
</div>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width"><p>In the previous lesson, we showed how to install Python packages
using the file <code>pyproject.toml</code>. However, if you ever find
yourself looking for online help on a Python packaging topic, you’ll
likely find a large number of alternative methods being recommended.
Some say you should use a file <code>setup.py</code>, while others
recommend a combination of <code>setup.cfg</code> and
<code>setup.py</code> – some even say to use both these and
<code>pyproject.toml</code>!</p>
<p>The reason for this conflicting information is that the Python
packaging ‘best practices’, as decided by the Python community, have
changed a number of times over the years. This lesson is optional, but
it will explain why some older tutorials recommend some methods over the
ones we’ve covered here. The intention here is not to present
alternative methods so that you can use them in new projects, but rather
to provide some context to the often confusing information out there,
and to help if you ever find yourself working on a project that hasn’t
yet updated to the latest standards.</p>
</section><section id="in-the-beginning-there-was-distutils"><h2 class="section-heading">In the beginning, there was <code>distutils</code><a class="anchor" aria-label="anchor" href="#in-the-beginning-there-was-distutils"></a>
</h2>
<hr class="half-width"><p>First introduced with Python 2.2, <code>distutils</code> was a module
of Python’s standard library that allowed users to install and
distribute their own packages. However, it was deprecated in <a href="https://peps.python.org/pep-0632/" class="external-link">PEP 632</a>, having been
superceded by <code>setuptools</code>. The primary issue with
<code>distutils</code> is that it is strongly coupled to the user’s
Python version, and the developers found they could not implement some
features or fixes without breaking inter-version compatibility.
Nowadays, it is recommended to use a combination of <code>pip</code> and
<code>setuptools</code> instead, but it will be useful to briefly cover
basic <code>distutils</code> usage so that we can understand some of the
design choices that would follow.</p>
<p>To use <code>distutils</code> to install a package, the user would
create a file <code>setup.py</code> and (optionally)
<code>requirements.txt</code> in the same directory as the top-level
package:</p>
<p><code> 📁 epi_models<br> |<br> |____📜 setup.py<br> |____📜
requirements.txt<br> |____📦 epi_models<br>      |<br>      |____📜
__init__.py<br>      |____📜 __main__.py<br>      |____📁 models<br>
     |____📁 plotting<br></code></p>
<p>The file <code>setup.py</code> should contain a script that contains
metadata about the package and its author(s). A very simple one might
look like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file: setup.py</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> distutils.core <span class="im">import</span> setup</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>setup(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"epi_models"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"1.0"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"Epidemiology modelling tools in Python"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    author<span class="op">=</span><span class="st">"Jordan Smith"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    author_email<span class="op">=</span><span class="st">"jsmith@email.net"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    url<span class="op">=</span><span class="st">"https://github.com/jsmith1234/epi_models"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    packages<span class="op">=</span>[<span class="st">"epi_models"</span>, <span class="st">"epi_models.models"</span>, <span class="st">"epi_models.plotting"</span>],</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Note that each subpackage is explicitly listed, unlike modern systems
that make assumptions about your directory structure and perform
automatic package discovery.</p>
<p>To install, <code>setup.py</code> could be run as a script with the
argument <code>install</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 setup.py install</span></code></pre>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>Installing by running <code>setup.py</code> as a script is highly
discouraged. If you’re using a package that still uses
<code>setup.py</code>, use <code>pip install .</code> as usual.</p>
</div>
</div>
</div>
<p>This creates a ‘source distribution’ in a new directory
<code>./build</code>, and adds it to the current environment. We can see
how the package is added to our environmentby reading the output written
to the terminal:</p>
<pre class="result"><code>creating /path/to/my/env/lib/python3.8/site-packages/epi_models
copying build/lib/epi_models/__init__.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models
creating /path/to/my/env/lib/python3.8/site-packages/epi_models/models
copying build/lib/epi_models/models/utils.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/models
copying build/lib/epi_models/models/__init__.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/models
copying build/lib/epi_models/models/SEIR.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/models
copying build/lib/epi_models/models/SIR.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/models
copying build/lib/epi_models/models/SIS.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/models
creating /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting
copying build/lib/epi_models/plotting/__init__.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting
copying build/lib/epi_models/plotting/plot_SIS.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting
copying build/lib/epi_models/plotting/plot_SEIR.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting
copying build/lib/epi_models/plotting/plot_SIR.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting
copying build/lib/epi_models/__main__.py -&gt; /path/to/my/env/lib/python3.8/site-packages/epi_models
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/__init__.py to __init__.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/models/utils.py to utils.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/models/__init__.py to __init__.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/models/SEIR.py to SEIR.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/models/SIR.py to SIR.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/models/SIS.py to SIS.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting/__init__.py to __init__.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting/plot_SIS.py to plot_SIS.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting/plot_SEIR.py to plot_SEIR.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/plotting/plot_SIR.py to plot_SIR.cpython-38.pyc
byte-compiling /path/to/my/env/lib/python3.8/site-packages/epi_models/__main__.py to __main__.cpython-38.pyc</code></pre>
<p>There are three stages:</p>
<ul><li>First, create <code>./build</code> and make a source distribution
there.</li>
<li>Create a new directory within
<code>/path/to/my/env/lib/python3.8/site-packages/</code>, and copy the
contents of <code>./build/lib</code>.</li>
<li>Compile each file to Python bytecode so it can be run more quickly
later.</li>
</ul><p>The end result is therefore very similar to what happens when we
install using <code>pyproject.toml</code>. However, a significant
downside of using <code>distutils</code> and <code>setup.py</code> is
that there is no way to safely uninstall a project once it has been
installed, and instead the user must manually remove the package from
their <code>site-packages</code> folder. The creation of a
<code>./build</code> directory also tends to clutter up our
workspace.</p>
<p><code>distutils</code> contains many other utilities, such as adding
language extensions written in C. However, it does not allow users to
specify dependencies, and these are instead expected to be listed in the
file <code>requirements.txt</code>:</p>
<pre><code><span><span class="va">matplotlib</span><span class="op">&gt;=</span><span class="fl">3.6</span></span></code></pre>
<p>The user can install the requirements by calling:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> pip <span class="at">-r</span> requirements.txt</span></code></pre>
</div>
<p>It is not recommended to use <code>distutils</code> for new projects,
and it will be removed from standard Python distributions in version
3.12. Listing dependencies in <code>requirements.txt</code> is also no
longer required.</p>
</section><section id="setuptools-and-egg-files"><h2 class="section-heading">
<code>setuptools</code> and <code>egg</code> files<a class="anchor" aria-label="anchor" href="#setuptools-and-egg-files"></a>
</h2>
<hr class="half-width"><p><code>setuptools</code> is not part of the core Python library, but
it has become the <em>de facto</em> standard build tool. Originally, it
added extra functionality on top of <code>distutils</code> using a
complicated collection of subclasses and monkeypatching, and it offered
better support across multiple Python versions. It has since superceded
<code>distutils</code> entirely.</p>
<p>Using <code>setuptools</code>, it is possible to use
<code>setup.py</code> to define a package in much the same way as
<code>distutils</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file: setup.py</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> setuptools <span class="im">import</span> setup</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>setup(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"epi_models"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">"1.0"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"Epidemiology modelling tools in Python"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    author<span class="op">=</span><span class="st">"Jordan Smith"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    author_email<span class="op">=</span><span class="st">"jsmith@email.net"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    url<span class="op">=</span><span class="st">"https://github.com/jsmith1234/epi_models"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    packages<span class="op">=</span>[<span class="st">"epi_models"</span>, <span class="st">"epi_models.models"</span>, <span class="st">"epi_models.plotting"</span>],</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    install_requires<span class="op">=</span>[<span class="st">"matplotlib&gt;=3.6"</span>],</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Note the addition of an extra field, <code>install_requires</code>.
This allows us to specify the dependencies without the extra file
<code>requirements.txt</code>, and these libraries will be installed
alongside our package when we install it.</p>
<p>We can run this file just as we did with <code>distutils</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 setup.py install</span></code></pre>
</div>
<p>Again, this will create a new directory <code>./build</code>, but it
will also create a directory <code>./dist</code>. Much as before,
<code>./build</code> contains a ‘source distribution’ of our code, while
<code>./dist</code> contains a file with a name such as
<code>epi_models-1.0-py3.8.egg</code> and a directory
<code>epi_models.egg-info</code> containing metadata files describing
our project. The ‘egg’ file is a distributable package format used by
<code>setuptools</code>, and is essentially just a <code>.zip</code>
file containing our package with a name specifying both the package
version and the version of Python it runs on. We can show this on Linux
systems using the <code>unzip</code> command line utility:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> unzip dist/epi_models-1.0-py3.8.egg <span class="at">-d</span> test</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls test</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>EGG-INFO epi_models</code></pre>
</div>
<p>Inside the <code>.egg</code> file, we find a copy of the
<code>.egg-info</code> directory created earlier, and a copy of our
package. If we look inside this version of our package, we can also see
that each directory contains a <code>__pycache__</code>, with Python
bytecode <code>.pyc</code> files inside, meaning each file has been
pre-compiled. This is done to optimise the egg file, as they are
intended to be directly importable. However, it also means the egg file
is only compatible with some Python versions, so projects written to be
compatible with both Python 2 and Python 3 must have separate
<code>.egg</code> files for each Python version. Egg files have been
superseded by ‘wheel’ files, which we’ll discuss in the next lesson.</p>
<p>So what happens when we install with <code>setuptools</code> as
opposed to <code>distutils</code>? A clue can be found in some of the
text outputted when we installed:</p>
<pre class="result"><code>Adding epi-models 1.0 to easy-install.pth file</code></pre>
<p>If we look in our <code>site-packages</code> directory, we’ll see a
file <code>easy-install.pth</code>. This is a path configuration file,
denoted by the extension <code>.pth</code>, and if any are found within
<code>site-packages</code> (or a number of other Python configuration
directories), any additional items listed in it will be added to
<code>sys.path</code> whenever Python is loaded up. If we look into this
file, we find:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat /path/to/my/env/lib/python3.8/site-packages/easy-install.pth</span></code></pre>
</div>
<pre class="result"><code><span><span class="va">.</span><span class="op">/</span><span class="va">epi_models</span><span class="op">-</span><span class="fl">1.0</span><span class="op">-</span><span class="va">py3.8.egg</span></span></code></pre>
<p>Therefore, rather than copying our source distribution into
<code>site-packages</code>, <code>setuptools</code> has instead copied
the egg file and added its location to <code>sys.path</code>. This last
step is necessary, as while Python is capable of running/importing
zipped directories, it doesn’t automatically search zip files on the
import path for any modules contained within.</p>
<p>Although there is still no way to uninstall using
<code>setup.py</code>, it is possible to remove a package installed this
way using pip:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> pip uninstall epi_models</span></code></pre>
</div>
</section><section id="using-pip-instead-of-running-setup.py"><h2 class="section-heading">Using <code>pip</code> instead of running <code>setup.py</code><a class="anchor" aria-label="anchor" href="#using-pip-instead-of-running-setup.py"></a>
</h2>
<hr class="half-width"><p>The direct usage of <code>setup.py</code> is now discouraged. After
installing a package using <code>python3 setup.py install</code>, there
is no equivalent command to uninstall. It also tends to clutter the
user’s workspace by creating local <code>./build</code> and
<code>./dist</code> directories. Both of these problems can be solved
using <code>pip</code>, which also provides a number of further
benefits:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> pip install .</span></code></pre>
</div>
<p>This will install the library to the current Python environment. It
can then be uninstalled using:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> pip uninstall epi_models</span></code></pre>
</div>
<p>When installing with <code>pip</code> instead of running
<code>setup.py</code>, no <code>./build</code> or <code>./dist</code>
directories are created, nor are any <code>.egg</code> files. Two lines
which are printed to screen during the install process explain what is
happening instead:</p>
<pre class="result"><code>Created wheel for epi-models: filename=epi_models-1.0-py3-none-any.whl size=4968 sha256=f876a8ce10a3b6a6d0261f4d739b1d78904153b4feaf2b37f83de60e4b9c2d36
Stored in directory: /tmp/pip-ephem-wheel-cache-_og4ywxd/wheels/d9/4d/ac/bbc1437fd83635787dd0fb8c3df8da61fc7b57f6eaa2b0d17b</code></pre>
<p>Instead of creating an egg file, a ‘wheel’ is created instead. We’ll
cover wheel files in more detail in the next lesson, but to summarise, a
wheel is very similar to an egg file except for two major
differences:</p>
<ul><li>The code within is not compiled to Python bytecode.</li>
<li>The name of the file contains more information regarding its
compatibility.</li>
</ul><p>The wheel is created in a temporary directory (<code>/tmp</code> on
most Linux systems) so that it doesn’t clutter up our workspace, and
when installing from a wheel, the file is unzipped within
<code>site-packages</code> and the code within is compiled to bytecode.
This is in contrast to egg files, which remain zipped at all times and
come with their code pre-compiled.</p>
<p>To aid code development, we can also create <em>editable
installs</em>, in which the user’s changes to the code are automatically
picked up and there is no need to reinstall:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> pip install <span class="at">-e</span> .</span></code></pre>
</div>
<p>This works simply by adding the path of our working directory into
<code>easy-install.pth</code> within the <code>site-packages</code>
directory. It will also install any dependencies of the project as
normal.</p>
<p>The usage of <code>setup.py</code> gained further criticism, even
when used alonside <code>pip</code>. As library writers were able to add
arbitrary code to this file, setup scripts often became very long and
difficult for users to understand. They could also contain potentially
dangerous (or even malicious) code that may not be apparent at first
glance. <code>distutils</code> had also supported an alternative method
of specifying package metadata using an additional file
<code>setup.cfg</code>, and in time this became the preferred
method.</p>
</section><section id="setup.cfg-as-a-declarative-config"><h2 class="section-heading">
<code>setup.cfg</code> as a ‘Declarative Config’<a class="anchor" aria-label="anchor" href="#setup.cfg-as-a-declarative-config"></a>
</h2>
<hr class="half-width"><p>Instead of using <code>setup.py</code> to define our package
metadata, it is preferable to instead use the file
<code>setup.cfg</code>. Instead of being a runnable Python module, this
file is simply a config file that can be read using Python’s built-in
<code>configparser</code> tool. Its format is very similar to INI files
commonly used on Windows systems. It should be included at the very top
of a project, just like <code>setup.py</code>:</p>
<p><code> 📁 epi_models<br> |<br> |____📜 setup.cfg<br> |____📜
setup.py<br> |____📦 epi_models<br>      |<br>      |____📜
__init__.py<br>      |____📜 __main__.py<br>      |____📁 models<br>
     |____📁 plotting<br></code></p>
<p><code>setup.py</code> is still present, but it can be reduced to a
very simple form:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file: setup.py</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> setuptools <span class="im">import</span> setup</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>setup()</span></code></pre>
</div>
<p>The <code>setup.py</code> files we used earlier can be easily adapted
to a corresponding <code>setup.cfg</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">INI<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode ini" tabindex="0"><code class="sourceCode ini"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">; file: setup.cfg</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">[metadata]</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dt">name </span><span class="ot">=</span><span class="st"> epi_models</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="dt">version </span><span class="ot">=</span><span class="st"> </span><span class="fl">1.0</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="dt">description </span><span class="ot">=</span><span class="st"> Epidemiology modelling tools in Python</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="dt">author </span><span class="ot">=</span><span class="st"> Jordan Smith</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="dt">author_email </span><span class="ot">=</span><span class="st"> jsmith@email.net</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="dt">url </span><span class="ot">=</span><span class="st"> "https://github.com/jsmith1234/epi_models"</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">[options]</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="dt">packages </span><span class="ot">=</span><span class="st"> find:</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="dt">install_requires </span><span class="ot">=</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="dt">    matplotlib &gt;</span><span class="ot">=</span><span class="st"> </span><span class="fl">3.6</span></span></code></pre>
</div>
<p>Note that the values on the right hand side of each equals sign are
all intepretted as strings by default, and double quotes are only needed
to escape certain special characters. Values can stretch over a line
break by indenting the next line down. Comment lines start with either
<code>;</code> or <code>#</code>, and inline comments are not
allowed.</p>
<p>The benefit of using this file over <code>setup.py</code> is that the
number of possible operations is restricted. This prevents users from
writing overly complex <code>setup.py</code> files that include
arbitrary and potentially dangerous computations. This is also
beneficial from an automation standpoint, as it is easy for tools
besides <code>setuptools</code> to read <code>setup.cfg</code> and
deduce useful information about a package.</p>
<p>Note that in converting our <code>setup.py</code> to a
<code>setup.cfg</code>, we are no longer listing each package and
subpackage, and instead we are using the line:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">INI<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode ini" tabindex="0"><code class="sourceCode ini"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">packages </span><span class="ot">=</span><span class="st"> find:</span></span></code></pre>
</div>
<p>This instructs <code>setuptools</code> to detect packages itself. We
could instead specify this manually using:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">INI<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode ini" tabindex="0"><code class="sourceCode ini"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">packages </span><span class="ot">=</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">    epi_models</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="dt">    epi_models.models</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dt">    epi_models.plotting</span></span></code></pre>
</div>
<p>A common alternative project layout is to place the top-level package
in a directory <code>src</code>:</p>
<p><code> 📁 epi_models<br> |<br> |____📜 setup.py<br> |____📜
setup.cfg<br> |____📁 src<br>      |<br>      |____📦 epi_models<br>
          |<br>           |____📜 __init__.py<br>           |____📜
__main__.py<br>           |____📁 models<br>           |____📁
plotting<br></code></p>
<p>Our <code>setup.cfg</code> file should be rewritten as follows:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">INI<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode ini" tabindex="0"><code class="sourceCode ini"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[options]</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">package_dir </span><span class="ot">=</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">    </span><span class="ot">=</span><span class="st">src</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dt">packages </span><span class="ot">=</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="dt">    epi_models</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dt">    epi_models.models</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dt">    epi_models.plotting</span></span></code></pre>
</div>
<p>We can also continue using <code>packages = find:</code> by adding an
extra heading to our config file:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">INI<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode ini" tabindex="0"><code class="sourceCode ini"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[options]</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">package_dir </span><span class="ot">=</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="dt">    </span><span class="ot">=</span><span class="st">src</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dt">packages </span><span class="ot">=</span><span class="st"> find:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[options.packages.find]</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dt">where </span><span class="ot">=</span><span class="st"> src</span></span></code></pre>
</div>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>Recent versions of <code>setuptools</code> can handle either the
‘flat’ layout or the <code>src</code>-layout using just
<code>packages = find:</code>.</p>
</div>
</div>
</div>
<p>There are many additional ways to organise a project, and it is
possible to set package names to something other than the corresponding
directory name, but it is recommended to keep the directory structure of
your projects as close as possible to that of the Python package. See
the <a href="https://setuptools.pypa.io/en/latest/references/keywords.html" class="external-link">documentation
for <code>setuptools</code> keywords</a> for more information.</p>
</section><section id="pyproject.toml-and-circular-build-requirements"><h2 class="section-heading">
<code>pyproject.toml</code> and Circular Build Requirements<a class="anchor" aria-label="anchor" href="#pyproject.toml-and-circular-build-requirements"></a>
</h2>
<hr class="half-width"><p>We saw in the previous sections that <code>setuptools</code> allows
library writers to specify the requirements of their packages and allow
users to automatically download and install dependencies. However, there
is always one requirement missing from this list:
<code>setuptools</code> itself! It would be useful if we could add
<code>setuptools</code> to our <code>install_requires</code>, but the
user already needs to have <code>setuptools</code> installed in order to
parse this field! In the era of <code>distutils</code>, this was not a
problem for Python developers, as <code>distutils</code> was shipped as
part of Python’s standard library.</p>
<p>The resolution to this problem came in <a href="https://peps.python.org/pep-0517/" class="external-link">PEP 517</a> and <a href="https://peps.python.org/pep-0518/" class="external-link">PEP 518</a>, which specifies
how to set build system requires within a new config file,
<code>pyproject.toml</code>. <code>setup.cfg</code> is understood by
<code>setuptools</code> (and possibly <code>distutils</code>), but
<code>pyproject.toml</code> is intended to be understood by <em>any</em>
Python build tool, current or future. This includes <code>pip</code> and
alternatives such as <code>flit</code> or <code>poetry</code>.</p>
<p>To specify our build system following <a href="https://peps.python.org/pep-0517/" class="external-link">PEP 517</a>/<a href="https://peps.python.org/pep-0518/" class="external-link">518</a>,
<code>pyproject.toml</code> should be added to our project at the same
level as <code>setup.py</code> and <code>setup.cfg</code>:</p>
<p><code> 📁 epi_models<br> |<br> |____📜 pyproject.toml<br> |____📜
setup.py<br> |____📜 setup.cfg<br> |____📦 epi_models<br>      |<br>
     |____📜 __init__.py<br>      |____📜 __main__.py<br>      |____📁
models<br>      |____📁 plotting<br></code></p>
<p>At a minimum, it should contain the following:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">build-system</span><span class="kw">]</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">"setuptools &gt;= 61"</span><span class="op">]</span></span></code></pre>
</div>
<p>Following this, we may install our package using <code>pip</code>
without first having <code>setuptools</code> installed. If we have an
older version of <code>setuptools</code> installed, <code>pip</code>
will now fetch the latest version in an isolated virtual environment
prior to building our project.</p>
<p>If we try installing however, we may find the following warnings:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> python3 <span class="at">-m</span> pip install .</span></code></pre>
</div>
<pre class="result"><code>WARNING: Missing build requirements in pyproject.toml for file:///my/file/path.
WARNING: The project does not specify a build backend, and pip cannot fall back to setuptools without 'wheel'.</code></pre>
<p>This means that <code>pip</code> is falling back on default
behaviour, as we have not fully specified our build system. By default,
<code>pip</code> will use <code>setuptools</code> (more specifically,
the build backend <code>setuptools.build_meta:__legacy__</code>), and it
requires the additional package <code>wheel</code> (which we’ll discuss
further in the next lesson). To explicitly set our build system, we must
also provide a <code>build-backend</code>:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># file: pyproject.toml</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">build-system</span><span class="kw">]</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"setuptools &gt;= 65"</span><span class="op">,</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"wheel &gt;= 0.38,</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"setuptools.build_meta"</span></span></code></pre>
</div>
</section><section id="moving-to-pyproject.toml-only-builds"><h2 class="section-heading">Moving to <code>pyproject.toml</code>-only builds<a class="anchor" aria-label="anchor" href="#moving-to-pyproject.toml-only-builds"></a>
</h2>
<hr class="half-width"><p>Following <a href="https://peps.python.org/pep-0517/" class="external-link">PEP 517</a>/<a href="https://peps.python.org/pep-0518/" class="external-link">518</a>, it was realised that
<code>pyproject.toml</code> and <code>setup.cfg</code> were both solving
similar problems, although <code>pyproject.toml</code> was to be a
standardised config file, while <code>setup.cfg</code> was
<code>setuptools</code> specific (although many other tools in the
Python ecosystem had also adopted the usage of <code>setup.cfg</code>).
Altenative build tools such as <code>poetry</code> and <code>flit</code>
opted to use <code>pyproject.toml</code> alone to define Python
packages, and this was eventually codified as a requirement for all
build tools in <a href="https://peps.python.org/pep-0621/" class="external-link">PEP
621</a>.</p>
<p>The aim of <a href="https://peps.python.org/pep-0621/" class="external-link">PEP 621</a> is
to standardise a set of ‘core’ metadata that any build tool should
recognise, such as <code>name</code>, <code>version</code>,
<code>description</code>, <code>authors</code>, etc. Tools may choose to
use their own synonyms for this metadata, and they may provide many more
options than the core set, but to be standards compliant they must
recognise the metadata of <a href="https://peps.python.org/pep-0621/" class="external-link">PEP 621</a> at a minimum.</p>
</section><section id="the-end-of-setup.py"><h2 class="section-heading">The end of <code>setup.py</code><a class="anchor" aria-label="anchor" href="#the-end-of-setup.py"></a>
</h2>
<hr class="half-width"><p>With <a href="https://peps.python.org/pep-0621/" class="external-link">PEP 621</a> removing
the need for <code>setup.cfg</code>, one might expect that the older
<code>setup.py</code> could be removed too. However,
<code>setuptools</code> still required this file for some features to
work, including editable installs. With <a href="https://peps.python.org/pep-0660/" class="external-link">PEP 660</a>, the Python
community standardised a way to use wheel files to create editable
installs, and therefore the use of <code>setup.py</code> is no longer
required. However, this feature was only recently implemented in
<code>pip</code>, so users may need to upgrade if they wish to use this
feature:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install <span class="at">--upgrade</span> pip</span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>The ‘best practices’ for Python packaging has changed a number of
times, and there are now many competing tools for accomplishing the same
task.</li>
<li>Be wary of information on this topic in online tutorials – not all
guides have been updated to use the most recent methods, and some advice
may no longer be relevant.</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-building-and-installing.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/05-publishing.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-building-and-installing.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Building and
        </a>
        <a class="chapter-link float-end" href="../instructor/05-publishing.html" rel="next">
          Next: Publishing our... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/python_packaging/edit/main/episodes/04-history-of-packaging.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/python_packaging/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/carpentries-incubator/python_packaging/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/python_packaging/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:liam.pattinson@york.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.15.0" class="external-link">sandpaper (0.15.0)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.4.0" class="external-link">varnish (0.4.0)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/python_packaging/instructor/04-history-of-packaging.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Extra: A History of Python Build Tools",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/python_packaging/instructor/04-history-of-packaging.html",
  "identifier": "https://carpentries-incubator.github.io/python_packaging/instructor/04-history-of-packaging.html",
  "dateCreated": "2023-07-04",
  "dateModified": "2023-11-21",
  "datePublished": "2023-12-05"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

